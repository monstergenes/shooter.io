<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Space Shooter with FBX</title>
</head>
<body>
    <div id="score">Score: 0</div>
    <div id="gameOver">Game Over</div>
    <script type="module">
        import * as THREE from 'https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.module.js';
        import { FBXLoader } from 'https://cdn.jsdelivr.net/npm/three/examples/jsm/loaders/FBXLoader.js';

        let score = 0;
        let gameOver = false;

        // Scene, camera, and renderer setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Lighting
        const light = new THREE.AmbientLight(0xffffff, 0.8);
        scene.add(light);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(5, 5, 5).normalize();
        scene.add(directionalLight);

        // FBX Loader
        const loader = new FBXLoader();

        // Player spaceship
        let player;
        loader.load('path_to_player.fbx', (object) => {
            player = object;
            player.scale.set(0.01, 0.01, 0.01); // Adjust scaling
            player.position.set(0, -3, -10);
            scene.add(player);
        });

        // Arrays for bullets and enemies
        const bullets = [];
        const enemies = [];

        // Enemy spaceship model
        let enemyModel;
        loader.load('path_to_enemy.fbx', (object) => {
            enemyModel = object;
            enemyModel.scale.set(0.01, 0.01, 0.01); // Adjust scaling
        });

        // Bullet model
        let bulletModel;
        loader.load('path_to_bullet.fbx', (object) => {
            bulletModel = object;
            bulletModel.scale.set(0.01, 0.01, 0.01); // Adjust scaling
        });

        // Create a new enemy
        function createEnemy() {
            if (!enemyModel) return;
            const enemy = enemyModel.clone();
            enemy.position.set((Math.random() - 0.5) * 10, 3, -15);
            enemies.push(enemy);
            scene.add(enemy);
        }

        // Fire a bullet
        function fireBullet() {
            if (!bulletModel) return;
            const bullet = bulletModel.clone();
            bullet.position.set(player.position.x, player.position.y, player.position.z);
            bullets.push(bullet);
            scene.add(bullet);
        }

        // Move player with keyboard
        const keys = {};
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
        });
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        function movePlayer() {
            if (!player) return;
            if (keys['ArrowLeft'] && player.position.x > -5) player.position.x -= 0.1;
            if (keys['ArrowRight'] && player.position.x < 5) player.position.x += 0.1;
            if (keys['ArrowUp'] && player.position.y < 0) player.position.y += 0.1;
            if (keys['ArrowDown'] && player.position.y > -5) player.position.y -= 0.1;
        }

        // Move bullets
        function moveBullets() {
            bullets.forEach((bullet, index) => {
                bullet.position.z -= 0.3;
                if (bullet.position.z < -50) {
                    scene.remove(bullet);
                    bullets.splice(index, 1);
                }
            });
        }

        // Move enemies
        function moveEnemies() {
            enemies.forEach((enemy, index) => {
                enemy.position.z += 0.1;
                if (enemy.position.z > 0) {
                    gameOver = true;
                    document.getElementById('gameOver').style.display = 'block';
                }
            });
        }

        // Check for collisions
        function checkCollisions() {
            enemies.forEach((enemy, enemyIndex) => {
                bullets.forEach((bullet, bulletIndex) => {
                    if (bullet.position.distanceTo(enemy.position) < 0.5) {
                        scene.remove(enemy);
                        scene.remove(bullet);
                        enemies.splice(enemyIndex, 1);
                        bullets.splice(bulletIndex, 1);

                        // Update score
                        score += 10;
                        document.getElementById('score').innerText = `Score: ${score}`;
                    }
                });
            });
        }

        // Animation loop
        function animate() {
            if (gameOver) return;

            requestAnimationFrame(animate);
            movePlayer();
            moveBullets();
            moveEnemies();
            checkCollisions();
            renderer.render(scene, camera);
        }

        // Spawn enemies at intervals
        setInterval(createEnemy, 2000);

        // Start the game
        animate();
    </script>
</body>
</html>
